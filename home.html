<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Draw with me</title>
</head>
    <body>
        <div>
            <h1> Home page</h1>
            <p>
                <button id="create-room">Create new room</button>
            </p>
        </div>
        <div id="rooms"> 
            <ul id="rooms-list"></ul>
        </div>
    </body>
    <script type="application/javascript">
        const createRoom = document.getElementById("create-room");
        const roomsList = document.getElementById("rooms-list");
        // On page load
        window.addEventListener('load', function (e) {
            var client = new XMLHttpRequest();
            client.onload = getRoomsHandler;
            client.open("GET", "get-rooms");
            client.send();
        })
        // GET create-room when button is selected
        createRoom.addEventListener("click", function (e) {
            var client = new XMLHttpRequest();
            client.onload = createRoomHandler;
            client.open("GET", "create-room");
            client.send();
        });
        
        // Handle response from "create-room" GET request
        function createRoomHandler() {
            console.log(this);
            if(this.status == 200 &&
                this.response != null) {
                // success!
                processCreateRoomData(this.response);
            } else {
                // something went wrong
                console.log("issue with GET request to /create-room")
            }
        }
        // Handle create-room GET request
        function processCreateRoomData(data) {
            // taking care of data
            console.log(data);
            addListElement(data, roomsList);
            
        }
        // Handle response from "create-room" GET request
        function getRoomsHandler() {
            console.log(this);
            if(this.status == 200 &&
                this.response != null) {
                // success!
                processGetRoomsData(this.response);
            } else {
                // something went wrong
                console.log("issue with GET request to /create-room")
            }
        }
        // Handle create-room GET request
        function processGetRoomsData(data) {
            console.log(data);
            if(data) {
                try {
                        jsonResponse = JSON.parse(data);
                        if(jsonResponse.RoomsList.length > 0) {
                            jsonResponse.RoomsList.forEach(roomLink => {
                                console.log(roomLink)
                                addListElement("/room-"+roomLink, roomsList);
                            });
                        }
                    } catch(e) {
                        alert(e); // error in the above string (in this case, yes)!
                    }
            }
        }

        function addListElement(data, parentElement) {
            var entry = document.createElement("li");
            var link = document.createElement("a")
            link.appendChild(document.createTextNode(data));
            link.href = document.location.href.substring(0, document.location.href.length-1) + data

            entry.appendChild(link);
            parentElement.appendChild(entry);
        }

        
    </script>

</html>